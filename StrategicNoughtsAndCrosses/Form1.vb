Public Class frmSNaC

    Dim player1 As Boolean = False

    Dim hasStarted As Boolean = False
    Dim hasWinner As Boolean = False
    Dim canRestart As Boolean = False

    Dim p1Score As Integer = 0
    Dim p2Score As Integer = 0

    Dim gameTime As Integer = 0

    Dim currentBoard As Integer = -1
    Dim previousBoard As Integer = -1

    Private Sub btn00_Click(sender As Object, e As EventArgs) Handles btn00.Click
        sumbitButtonPress(btn00)
    End Sub

    Private Sub btn01_Click(sender As Object, e As EventArgs) Handles btn01.Click
        sumbitButtonPress(btn01)
    End Sub

    Private Sub btn02_Click(sender As Object, e As EventArgs) Handles btn02.Click
        sumbitButtonPress(btn02)
    End Sub

    Private Sub btn03_Click(sender As Object, e As EventArgs) Handles btn03.Click
        sumbitButtonPress(btn03)
    End Sub

    Private Sub btn04_Click(sender As Object, e As EventArgs) Handles btn04.Click
        sumbitButtonPress(btn04)
    End Sub

    Private Sub btn05_Click(sender As Object, e As EventArgs) Handles btn05.Click
        sumbitButtonPress(btn05)
    End Sub

    Private Sub btn06_Click(sender As Object, e As EventArgs) Handles btn06.Click
        sumbitButtonPress(btn06)
    End Sub

    Private Sub btn07_Click(sender As Object, e As EventArgs) Handles btn07.Click
        sumbitButtonPress(btn07)
    End Sub

    Private Sub btn08_Click(sender As Object, e As EventArgs) Handles btn08.Click
        sumbitButtonPress(btn08)
    End Sub

    Private Sub btn10_Click(sender As Object, e As EventArgs) Handles btn10.Click
        sumbitButtonPress(btn10)
    End Sub

    Private Sub btn11_Click(sender As Object, e As EventArgs) Handles btn11.Click
        sumbitButtonPress(btn11)
    End Sub

    Private Sub btn12_Click(sender As Object, e As EventArgs) Handles btn12.Click
        sumbitButtonPress(btn12)
    End Sub

    Private Sub btn13_Click(sender As Object, e As EventArgs) Handles btn13.Click
        sumbitButtonPress(btn13)
    End Sub

    Private Sub btn14_Click(sender As Object, e As EventArgs) Handles btn14.Click
        sumbitButtonPress(btn14)
    End Sub

    Private Sub btn15_Click(sender As Object, e As EventArgs) Handles btn15.Click
        sumbitButtonPress(btn15)
    End Sub

    Private Sub btn16_Click(sender As Object, e As EventArgs) Handles btn16.Click
        sumbitButtonPress(btn16)
    End Sub

    Private Sub btn17_Click(sender As Object, e As EventArgs) Handles btn17.Click
        sumbitButtonPress(btn17)
    End Sub

    Private Sub btn18_Click(sender As Object, e As EventArgs) Handles btn18.Click
        sumbitButtonPress(btn18)
    End Sub

    Private Sub btn20_Click(sender As Object, e As EventArgs) Handles btn20.Click
        sumbitButtonPress(btn20)
    End Sub

    Private Sub btn21_Click(sender As Object, e As EventArgs) Handles btn21.Click
        sumbitButtonPress(btn21)
    End Sub

    Private Sub btn22_Click(sender As Object, e As EventArgs) Handles btn22.Click
        sumbitButtonPress(btn22)
    End Sub

    Private Sub btn23_Click(sender As Object, e As EventArgs) Handles btn23.Click
        sumbitButtonPress(btn23)
    End Sub

    Private Sub btn24_Click(sender As Object, e As EventArgs) Handles btn24.Click
        sumbitButtonPress(btn24)
    End Sub

    Private Sub btn25_Click(sender As Object, e As EventArgs) Handles btn25.Click
        sumbitButtonPress(btn25)
    End Sub

    Private Sub btn26_Click(sender As Object, e As EventArgs) Handles btn26.Click
        sumbitButtonPress(btn26)
    End Sub

    Private Sub btn27_Click(sender As Object, e As EventArgs) Handles btn27.Click
        sumbitButtonPress(btn27)
    End Sub

    Private Sub btn28_Click(sender As Object, e As EventArgs) Handles btn28.Click
        sumbitButtonPress(btn28)
    End Sub

    Private Sub btn30_Click(sender As Object, e As EventArgs) Handles btn30.Click
        sumbitButtonPress(btn30)
    End Sub

    Private Sub btn31_Click(sender As Object, e As EventArgs) Handles btn31.Click
        sumbitButtonPress(btn31)
    End Sub

    Private Sub btn32_Click(sender As Object, e As EventArgs) Handles btn32.Click
        sumbitButtonPress(btn32)
    End Sub

    Private Sub btn33_Click(sender As Object, e As EventArgs) Handles btn33.Click
        sumbitButtonPress(btn33)
    End Sub

    Private Sub btn34_Click(sender As Object, e As EventArgs) Handles btn34.Click
        sumbitButtonPress(btn34)
    End Sub

    Private Sub btn35_Click(sender As Object, e As EventArgs) Handles btn35.Click
        sumbitButtonPress(btn35)
    End Sub

    Private Sub btn36_Click(sender As Object, e As EventArgs) Handles btn36.Click
        sumbitButtonPress(btn36)
    End Sub

    Private Sub btn37_Click(sender As Object, e As EventArgs) Handles btn37.Click
        sumbitButtonPress(btn37)
    End Sub

    Private Sub btn38_Click(sender As Object, e As EventArgs) Handles btn38.Click
        sumbitButtonPress(btn38)
    End Sub

    Private Sub btn40_Click(sender As Object, e As EventArgs) Handles btn40.Click
        sumbitButtonPress(btn40)
    End Sub

    Private Sub btn41_Click(sender As Object, e As EventArgs) Handles btn41.Click
        sumbitButtonPress(btn41)
    End Sub

    Private Sub btn42_Click(sender As Object, e As EventArgs) Handles btn42.Click
        sumbitButtonPress(btn42)
    End Sub

    Private Sub btn43_Click(sender As Object, e As EventArgs) Handles btn43.Click
        sumbitButtonPress(btn43)
    End Sub

    Private Sub btn44_Click(sender As Object, e As EventArgs) Handles btn44.Click
        sumbitButtonPress(btn44)
    End Sub

    Private Sub btn45_Click(sender As Object, e As EventArgs) Handles btn45.Click
        sumbitButtonPress(btn45)
    End Sub

    Private Sub btn46_Click(sender As Object, e As EventArgs) Handles btn46.Click
        sumbitButtonPress(btn46)
    End Sub

    Private Sub btn47_Click(sender As Object, e As EventArgs) Handles btn47.Click
        sumbitButtonPress(btn47)
    End Sub

    Private Sub btn48_Click(sender As Object, e As EventArgs) Handles btn48.Click
        sumbitButtonPress(btn48)
    End Sub

    Private Sub btn50_Click(sender As Object, e As EventArgs) Handles btn50.Click
        sumbitButtonPress(btn50)
    End Sub

    Private Sub btn51_Click(sender As Object, e As EventArgs) Handles btn51.Click
        sumbitButtonPress(btn51)
    End Sub

    Private Sub btn52_Click(sender As Object, e As EventArgs) Handles btn52.Click
        sumbitButtonPress(btn52)
    End Sub

    Private Sub btn53_Click(sender As Object, e As EventArgs) Handles btn53.Click
        sumbitButtonPress(btn53)
    End Sub

    Private Sub btn54_Click(sender As Object, e As EventArgs) Handles btn54.Click
        sumbitButtonPress(btn54)
    End Sub

    Private Sub btn55_Click(sender As Object, e As EventArgs) Handles btn55.Click
        sumbitButtonPress(btn55)
    End Sub

    Private Sub btn56_Click(sender As Object, e As EventArgs) Handles btn56.Click
        sumbitButtonPress(btn56)
    End Sub

    Private Sub btn57_Click(sender As Object, e As EventArgs) Handles btn57.Click
        sumbitButtonPress(btn57)
    End Sub

    Private Sub btn58_Click(sender As Object, e As EventArgs) Handles btn58.Click
        sumbitButtonPress(btn58)
    End Sub

    Private Sub btn60_Click(sender As Object, e As EventArgs) Handles btn60.Click
        sumbitButtonPress(btn60)
    End Sub

    Private Sub btn61_Click(sender As Object, e As EventArgs) Handles btn61.Click
        sumbitButtonPress(btn61)
    End Sub

    Private Sub btn62_Click(sender As Object, e As EventArgs) Handles btn62.Click
        sumbitButtonPress(btn62)
    End Sub

    Private Sub btn63_Click(sender As Object, e As EventArgs) Handles btn63.Click
        sumbitButtonPress(btn63)
    End Sub

    Private Sub btn64_Click(sender As Object, e As EventArgs) Handles btn64.Click
        sumbitButtonPress(btn64)
    End Sub

    Private Sub btn65_Click(sender As Object, e As EventArgs) Handles btn65.Click
        sumbitButtonPress(btn65)
    End Sub

    Private Sub btn66_Click(sender As Object, e As EventArgs) Handles btn66.Click
        sumbitButtonPress(btn66)
    End Sub

    Private Sub btn67_Click(sender As Object, e As EventArgs) Handles btn67.Click
        sumbitButtonPress(btn67)
    End Sub

    Private Sub btn68_Click(sender As Object, e As EventArgs) Handles btn68.Click
        sumbitButtonPress(btn68)
    End Sub

    Private Sub btn70_Click(sender As Object, e As EventArgs) Handles btn70.Click
        sumbitButtonPress(btn70)
    End Sub

    Private Sub btn71_Click(sender As Object, e As EventArgs) Handles btn71.Click
        sumbitButtonPress(btn71)
    End Sub

    Private Sub btn72_Click(sender As Object, e As EventArgs) Handles btn72.Click
        sumbitButtonPress(btn72)
    End Sub

    Private Sub btn73_Click(sender As Object, e As EventArgs) Handles btn73.Click
        sumbitButtonPress(btn73)
    End Sub

    Private Sub btn74_Click(sender As Object, e As EventArgs) Handles btn74.Click
        sumbitButtonPress(btn74)
    End Sub

    Private Sub btn75_Click(sender As Object, e As EventArgs) Handles btn75.Click
        sumbitButtonPress(btn75)
    End Sub

    Private Sub btn76_Click(sender As Object, e As EventArgs) Handles btn76.Click
        sumbitButtonPress(btn76)
    End Sub

    Private Sub btn77_Click(sender As Object, e As EventArgs) Handles btn77.Click
        sumbitButtonPress(btn77)
    End Sub

    Private Sub btn78_Click(sender As Object, e As EventArgs) Handles btn78.Click
        sumbitButtonPress(btn78)
    End Sub

    Private Sub btn80_Click(sender As Object, e As EventArgs) Handles btn80.Click
        sumbitButtonPress(btn80)
    End Sub

    Private Sub btn81_Click(sender As Object, e As EventArgs) Handles btn81.Click
        sumbitButtonPress(btn81)
    End Sub

    Private Sub btn82_Click(sender As Object, e As EventArgs) Handles btn82.Click
        sumbitButtonPress(btn82)
    End Sub

    Private Sub btn83_Click(sender As Object, e As EventArgs) Handles btn83.Click
        sumbitButtonPress(btn83)
    End Sub

    Private Sub btn84_Click(sender As Object, e As EventArgs) Handles btn84.Click
        sumbitButtonPress(btn84)
    End Sub

    Private Sub btn85_Click(sender As Object, e As EventArgs) Handles btn85.Click
        sumbitButtonPress(btn85)
    End Sub

    Private Sub btn86_Click(sender As Object, e As EventArgs) Handles btn86.Click
        sumbitButtonPress(btn86)
    End Sub

    Private Sub btn87_Click(sender As Object, e As EventArgs) Handles btn87.Click
        sumbitButtonPress(btn87)
    End Sub

    Private Sub btn88_Click(sender As Object, e As EventArgs) Handles btn88.Click
        sumbitButtonPress(btn88)
    End Sub

    Private Sub frmSNaC_Load(sender As Object, e As EventArgs) Handles Me.Load

        lblInfo.Text = ""
        lbl0.SendToBack()
        lbl1.SendToBack()
        lbl2.SendToBack()
        lbl3.SendToBack()
        lbl4.SendToBack()
        lbl5.SendToBack()
        lbl6.SendToBack()
        lbl7.SendToBack()
        lbl8.SendToBack()
        lbl0.Text = " "
        lbl1.Text = " "
        lbl2.Text = " "
        lbl3.Text = " "
        lbl4.Text = " "
        lbl5.Text = " "
        lbl6.Text = " "
        lbl7.Text = " "
        lbl8.Text = " "

        For i = 0 To 8
            For Each button As Button In getSmallBoard(i)
                button.BackColor = ColorTranslator.FromHtml("#A2A2A2")
            Next
        Next

    End Sub

    Private Sub btnStart_Click(sender As Object, e As EventArgs) Handles btnStart.Click

        If Not hasStarted Then
            btnStart.Text = "Restart"
            hasStarted = True
        End If

        restart()

    End Sub





















    Private Function getSmallBoard(num As Integer)

        Dim buttons() As Button = {}

        Select Case num

            Case 0
                buttons = {btn00, btn01, btn02, btn03, btn04, btn05, btn06, btn07, btn08}
            Case 1
                buttons = {btn10, btn11, btn12, btn13, btn14, btn15, btn16, btn17, btn18}
            Case 2
                buttons = {btn20, btn21, btn22, btn23, btn24, btn25, btn26, btn27, btn28}
            Case 3
                buttons = {btn30, btn31, btn32, btn33, btn34, btn35, btn36, btn37, btn38}
            Case 4
                buttons = {btn40, btn41, btn42, btn43, btn44, btn45, btn46, btn47, btn48}
            Case 5
                buttons = {btn50, btn51, btn52, btn53, btn54, btn55, btn56, btn57, btn58}
            Case 6
                buttons = {btn60, btn61, btn62, btn63, btn64, btn65, btn66, btn67, btn68}
            Case 7
                buttons = {btn70, btn71, btn72, btn73, btn74, btn75, btn76, btn77, btn78}
            Case 8
                buttons = {btn80, btn81, btn82, btn83, btn84, btn85, btn86, btn87, btn88}

        End Select

        Return buttons

    End Function

    Private Function buttonsToBoardString(buttons() As Button)

        Dim board As String = ""

        For Each button As Button In buttons
            board += button.Text
        Next

        'Info(board.Replace(" ", "_"))
        'lblInfo.Text += board.Length.ToString()

        Return board

    End Function

    Private Sub sumbitButtonPress(btn As Button)

        If btn.Text = " " And (btn.BackColor = Color.Transparent Or btn.BackColor = SystemColors.Control) Then

            Dim number As String = btn.Name.Substring(3)

            Dim coord1 As Integer = Val(number(0))
            Dim coord2 As Integer = Val(number(1))

            previousBoard = coord1
            currentBoard = coord2

            'btnStart.Text = Str(previousBoard) + " " + Str(currentBoard)

            If player1 Then

                player1 = False
                btn.Text = "X"
                btn.ForeColor = Color.Red
                Info("It is Player Two's turn.")

            Else

                player1 = True
                btn.Text = "O"
                btn.ForeColor = Color.Blue
                Info("It is Player One's turn.")

            End If

            clearHighlights()
            highlightSmallBoard(coord2)

            updateDisplay()

            'Else

            'Info("That square has already been used! Please try another.")

        End If

    End Sub

    Private Sub clearHighlights()

        For i = 0 To 8
            For Each button As Button In getSmallBoard(i)
                button.BackColor = Color.Transparent
            Next
        Next

    End Sub

    Private Sub clearBoard()

        For i = 0 To 9
            For Each button As Button In getSmallBoard(i)
                'button.BackColor = Color.Transparent
                button.Enabled = True
                button.Text = " "
            Next
        Next

    End Sub

    Private Sub highlightSmallBoard(num As Integer)

        Dim buttons() As Button = getSmallBoard(num)

        If smallBoardHasWinner(num) Or smallBoardFull(num) Then

            For i = 0 To 8
                If Not smallBoardHasWinner(i) Then
                    For Each button As Button In getSmallBoard(i)
                        button.BackColor = Color.Transparent 'ColorTranslator.FromHtml("#A2A2A2")
                        'button.BackColor = Color.Green
                        'button.Enabled = True
                    Next
                End If
            Next

        Else

            For i = 0 To 8
                If Not i = num Then
                    For Each button As Button In getSmallBoard(i)
                        button.BackColor = ColorTranslator.FromHtml("#A2A2A2")
                    Next
                End If
            Next

            'For Each button In buttons
            'button.BackColor = Color.Green
            'button.Enabled = True
            'Next

            'For i = 0 To 8
            'If Not i = num Then
            'For Each button As Button In getSmallBoard(i)
            'Button.BackColor = ColorTranslator.FromHtml("#A2A2A2")
            ''button.Enabled = False
            'Next
            'End If
            'Next

        End If

    End Sub

    Private Sub checkForWinner()

        Dim board As String = lbl0.Text + lbl1.Text + lbl2.Text + lbl3.Text + lbl4.Text + lbl5.Text + lbl6.Text + lbl7.Text + lbl8.Text

        If (board(0) = board(1) And board(1) = board(2) And board(2) <> " ") Or (board(0) = board(3) And board(3) = board(6) And board(6) <> " ") Or (board(0) = board(4) And board(4) = board(8) And board(8) <> " ") Then
            winner(board(0))
        End If

        If board(1) = board(4) And board(4) = board(7) And board(7) <> " " Then
            winner(board(1))
        End If

        If board(3) = board(4) And board(4) = board(5) And board(5) <> " " Then
            winner(board(3))
        End If

        If (board(2) = board(5) And board(5) = board(8) And board(8) <> " ") Or (board(6) = board(7) And board(7) = board(8) And board(8) <> " ") Then
            winner(board(8))
        End If

        If board(2) = board(4) And board(4) = board(6) And board(6) <> " " Then
            winner(board(2))
        End If

    End Sub

    Private Sub winner(winner As String)

        hasWinner = True

        For i = 0 To 8
            For Each button As Button In getSmallBoard(i)
                button.BackColor = ColorTranslator.FromHtml("#A2A2A2")
            Next
        Next

        If winner = "X" Then
            Info("Player One has won!")
            p1Score += 1
        ElseIf winner = "O" Then
            Info("Player Two has won!")
            p2Score += 1
        End If

        updateScore()

    End Sub

    Private Sub updateDisplay()

        If smallBoardHasWinner(previousBoard) Then

            setSmallBoardWinner(getSmallBoardWinner(previousBoard), previousBoard)

            checkForWinner()

        End If

    End Sub

    Private Sub updateScore()

        lblP1Score.Text = "P1 = " + Str(p1Score)
        lblP2Score.Text = "P2 = " + Str(p2Score)

    End Sub

    Private Function smallBoardHasWinner(num As Integer)

        Dim board As String = buttonsToBoardString(getSmallBoard(num))

        If (board(0) = board(1) And board(1) = board(2) And board(2) <> " ") Or (board(0) = board(3) And board(3) = board(6) And board(6) <> " ") Or (board(0) = board(4) And board(4) = board(8) And board(8) <> " ") Or (board(1) = board(4) And board(4) = board(7) And board(7) <> " ") Or (board(3) = board(4) And board(4) = board(5) And board(5) <> " ") Or (board(2) = board(5) And board(5) = board(8) And board(8) <> " ") Or (board(6) = board(7) And board(7) = board(8) And board(8) <> " ") Or (board(2) = board(4) And board(4) = board(6) And board(6) <> " ") Then
            'Info(board.Replace(" ", "_") + " True")
            Return True
        Else
            'Info(board.Replace(" ", "_") + " False")
            Return False
        End If

    End Function

    Private Function getSmallBoardWinner(num As Integer)

        Dim board As String = buttonsToBoardString(getSmallBoard(num))
        Dim winner = ""

        If (board(0) = board(1) And board(1) = board(2) And board(2) <> " ") Or (board(0) = board(3) And board(3) = board(6) And board(6) <> " ") Or (board(0) = board(4) And board(4) = board(8) And board(8) <> " ") Then
            winner = board(0)
        End If

        If board(1) = board(4) And board(4) = board(7) And board(7) <> " " Then
            winner = board(1)
        End If

        If board(3) = board(4) And board(4) = board(5) And board(5) <> " " Then
            winner = board(3)
        End If

        If (board(2) = board(5) And board(5) = board(8) And board(8) <> " ") Or (board(6) = board(7) And board(7) = board(8) And board(8) <> " ") Then
            winner = board(8)
        End If

        If board(2) = board(4) And board(4) = board(6) And board(6) <> " " Then
            winner = board(2)
        End If

        Return winner

    End Function

    Private Sub setSmallBoardWinner(winner As String, num As Integer)

        Dim label As Label

        Select Case num

            Case 0
                label = lbl0
            Case 1
                label = lbl1
            Case 2
                label = lbl2
            Case 3
                label = lbl3
            Case 4
                label = lbl4
            Case 5
                label = lbl5
            Case 6
                label = lbl6
            Case 7
                label = lbl7
            Case 8
                label = lbl8

        End Select

        label.Visible = True
        label.Text = winner

        If winner = "X" Then
            label.ForeColor = Color.Red
        ElseIf winner = "O" Then
            label.ForeColor = Color.Blue
        End If

        label.BringToFront()

    End Sub

    Private Function smallBoardFull(num As Integer)

        Dim board As String = buttonsToBoardString(getSmallBoard(num))

        If Not board.Contains(" ") Then
            Return True
        Else
            Return False
        End If

    End Function

    Private Sub restart()

        player1 = Not player1

        If player1 Then
            lblInfo.Text = "It is Player One's turn."
        Else
            lblInfo.Text = "It is Player Two's turn."
        End If

        lbl0.SendToBack()
        lbl1.SendToBack()
        lbl2.SendToBack()
        lbl3.SendToBack()
        lbl4.SendToBack()
        lbl5.SendToBack()
        lbl6.SendToBack()
        lbl7.SendToBack()
        lbl8.SendToBack()
        lbl0.Text = " "
        lbl1.Text = " "
        lbl2.Text = " "
        lbl3.Text = " "
        lbl4.Text = " "
        lbl5.Text = " "
        lbl6.Text = " "
        lbl7.Text = " "
        lbl8.Text = " "

        For i = 0 To 8
            For Each button As Button In getSmallBoard(i)
                button.Text = " "
                button.BackColor = Color.Transparent
            Next
        Next

    End Sub

    Private Sub Info(msg As String)
        lblInfo.Text = msg
    End Sub
End Class
